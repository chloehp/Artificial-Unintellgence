const wInput=document.getElementById("w-input");const wOutput=document.getElementById("w-output");const thingsUsrSaid=[];const thingsISaid=[];let next=null;function randomFromAr(ar){if(ar.length<2){return ar[0];}console.log("random from array");const ranNum=Math.floor(Math.random()*ar.length);const lastThingISaid=thingsISaid[thingsISaid.length-1];const arRan=ar[ranNum];if(arRan!==lastThingISaid){return arRan;}else{return randomFromAr(ar);}}function getNextPhrase(keyword,input){const endOfKeyword=input.indexOf(keyword)+keyword.length;const endOfNextPhrase=[input.indexOf(".",endOfKeyword),input.indexOf(",",endOfKeyword),input.indexOf("?",endOfKeyword),input.indexOf(" or ",endOfKeyword),input.indexOf(" for ",endOfKeyword),input.indexOf(" but ",endOfKeyword),input.indexOf(" because ",endOfKeyword),];let endNextIndex=input.length;for(let i=0;i<endOfNextPhrase.length;i+=1){if((endOfNextPhrase[i]>-1)&&(endOfNextPhrase[i]<endNextIndex)){endNextIndex=endOfNextPhrase[i]+1}}let nextPhrase=input.substring(endOfKeyword,endNextIndex);nextPhrase=nextPhrase.replaceAll(" i "," you ");nextPhrase=nextPhrase.replaceAll(" me "," you ");nextPhrase=nextPhrase.replaceAll(" my "," your ");nextPhrase=nextPhrase.replaceAll(" mine "," yours ");return nextPhrase.slice(1,nextPhrase.length-1)}function synonymise(input){for(let x=0;x<synonymsLen;x+=1){for(let y=0;y<synonyms[x].words.length;y+=1){input=input.replaceAll((" "+synonyms[x].words[y]+" "),(" "+synonyms[x].syn+" "))}}return input;}function berryl(usrInput=wInput.value){wInput.value="";thingsUsrSaid.push(usrInput);let output=respond(usrInput);output=output.replaceAll(" be it"," it is");thingsISaid.push(output);console.log("response: "+output);wOutput.innerHTML=output}function respond(usrInput){usrInput=" "+usrInput+" ";usrInput=usrInput.toLowerCase();usrInput=usrInput.replaceAll("'s "," is ");usrInput=usrInput.replaceAll("'nt "," not ");usrInput=usrInput.replaceAll("'d "," did ");usrInput=usrInput.replaceAll("'","");usrInput=usrInput.replaceAll('"',"");usrInput=usrInput.replaceAll("."," .");usrInput=usrInput.replaceAll(","," ,");usrInput=usrInput.replaceAll("?"," ?");usrInput=usrInput.replaceAll("!"," !");usrInput=synonymise(usrInput);usrInput=usrInput.replaceAll("  "," ");console.log("Dumbed down user input: "+usrInput);if(next){const nextResp=nextResponse(usrInput);if(nextResp){return nextResp;}}const keyResp=keyResponse(usrInput);if(keyResp){return keyResp;}else if(usrInput.length>9){return randomFromAr(noParseResponses)}else{return randomFromAr(nonsenseResponses)}}function keyResponse(input){let highestPriority=-1;let keyword="";let output="";for(let x=0;x<keywordResponsesLen;x+=1){if(keywordResponses[x].priority>highestPriority){for(let y=0;y<keywordResponses[x].kw.length;y+=1){if(input.includes(keywordResponses[x].kw[y])){highestPriority=x;keyword=keywordResponses[x].kw[y];}}}}if(highestPriority>-1){output=randomFromAr(keywordResponses[highestPriority].responses)}else{return null}if(output.includes("[POST]")){const nextPhrase=getNextPhrase(keyword,input);output=output.replaceAll("[POST]",nextPhrase);}console.log("keyResponse");return stringSpecials(output)}function nextResponse(input){let keyword="";let output="";for(let x=0;x<nextResponsesLen;x+=1){if(next===nextResponses[x].code){for(let y=0;y<nextResponses[x].ans.length;y+=1){const kw=nextResponses[x].ans[y].kw;for(let z=0;z<kw.length;z+=1){if(kw[z]==="%anything%"||input.includes(kw[z])){const answersResponses=nextResponses[x].ans[y].responses;keyword=kw[z];output=randomFromAr(answersResponses);break;}}}}}if(output===""){return null}if(output.includes("[POST]")){const nextPhrase=getNextPhrase(keyword,input);output=output.replaceAll("[POST]",nextPhrase)}console.log("nextResponse: "+next);return stringSpecials(output)}function stringSpecials(str){if(str.includes("[NEXT]")){const outAr=str.split("[NEXT]");str=outAr[0];next=outAr[1];}else{next=null}return str}